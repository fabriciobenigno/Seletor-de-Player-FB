<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Toque na Tela</title>

<!-- √çcones e manifest para PWA -->
<link rel="apple-touch-icon" href="Garrafa.png">
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-title" content="Seletor de Player">
<meta name="application-name" content="Seletor de Player">

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    background: #000;
    touch-action: none;
    font-family: sans-serif;
}

#container {
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;
    background: #000;
    overflow: hidden;
    z-index: 1;
}

/* TOUCHES */
.touch {
    position: absolute;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    transform: translate(-50%, -50%) scale(0);
    opacity: 0;
    pointer-events: none;
    transition: transform 0.35s ease, opacity 0.35s ease;
    backdrop-filter: blur(10px) saturate(160%);
    -webkit-backdrop-filter: blur(10px) saturate(160%);
    border: 2px solid rgba(255,255,255,0.2);
}

.touch.active { transform: translate(-50%, -50%) scale(1); opacity: 1; }
.touch.dimmed { opacity: 0.25; transform: translate(-50%, -50%) scale(0.9); }
.touch.selected { animation: cinematicPulse 1.2s ease forwards; z-index: 10; box-shadow: 0 0 50px rgba(255,255,255,0.9); }

@keyframes cinematicPulse {
    0%   { transform: translate(-50%, -50%) scale(1); }
    40%  { transform: translate(-50%, -50%) scale(2); }
    70%  { transform: translate(-50%, -50%) scale(1.6); }
    100% { transform: translate(-50%, -50%) scale(1.8); }
}

/* BOT√ÉO INSTALAR FIXO */
#installBtnFixed {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #fff;
    color: #000;
    border: none;
    padding: 12px 18px;
    border-radius: 25px;
    font-weight: bold;
    z-index: 9999;
    cursor: pointer;
}

/* OVERLAY INSTALA√á√ÉO */
#installOverlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.95);
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    color: #fff;
    text-align: center;
}

#installOverlay p { margin-bottom: 20px; font-size: 1.1em; }

#installOverlay button {
    margin: 8px;
    padding: 12px 18px;
    border-radius: 25px;
    border: none;
    font-weight: bold;
    cursor: pointer;
}

#instagramBtn { background: #34C759; color: #fff; }
#closeOverlayBtn { background: #fff; color: #000; }
</style>
</head>

<body>
<div id="container"></div>

<button id="installBtnFixed">Instalar</button>

<div id="installOverlay">
    <p>Adapta√ß√£o criada por Fabricio Benigno</p>
    <p>Passo a passo para instalar o app:</p>
    <ol>
        <li>Toque no bot√£o "Compartilhar" do navegador</li>
        <li>Escolha "Adicionar √† Tela de In√≠cio"</li>
    </ol>
    <button id="instagramBtn">Instagram</button>
    <button id="closeOverlayBtn">Fechar</button>
</div>

<script>
const container = document.getElementById("container");
const installBtnFixed = document.getElementById("installBtnFixed");
const installOverlay = document.getElementById("installOverlay");
const instagramBtn = document.getElementById("instagramBtn");
const closeOverlayBtn = document.getElementById("closeOverlayBtn");

/* üî• ADICIONADA 1 NOVA COR */
const baseColors = [
"#FF3B30",
"#34C759",
"#007AFF",
"#FF9500",
"#AF52DE",
"#5AC8FA",
"#FFD60A" // nova cor (7¬™)
];

let availableColors = [...baseColors];
let touchesMap = {};
let timer = null;
let audioContext = null;
let fullscreenActivated = false;

function isStandalone() {
    return window.matchMedia('(display-mode: standalone)').matches
        || window.navigator.standalone === true;
}

if(isStandalone()) installBtnFixed.style.display = "none";

function enterFullscreen() {
    if(fullscreenActivated) return;
    fullscreenActivated = true;
    if(document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
    else if(document.documentElement.webkitRequestFullscreen) document.documentElement.webkitRequestFullscreen();
}

function initAudio() { 
    if(!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)(); 
}

function playWinSound() {
    if(!audioContext) return;
    const osc = audioContext.createOscillator();
    const gain = audioContext.createGain();
    osc.type="triangle";
    osc.frequency.setValueAtTime(700, audioContext.currentTime);
    osc.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime+0.25);
    gain.gain.setValueAtTime(0.001, audioContext.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.6, audioContext.currentTime+0.05);
    gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime+0.4);
    osc.connect(gain);
    gain.connect(audioContext.destination);
    osc.start();
    osc.stop(audioContext.currentTime+0.4);
}

function restartTimer(){ 
    clearTimeout(timer); 
    if(Object.keys(touchesMap).length>0) 
        timer=setTimeout(selectRandom,3000); 
}

function selectRandom(){
    const keys = Object.keys(touchesMap);
    if(keys.length===0) return;
    const randomKey = keys[Math.floor(Math.random()*keys.length)];
    Object.keys(touchesMap).forEach(key=>{
        if(key===randomKey) touchesMap[key].classList.add("selected");
        else touchesMap[key].classList.add("dimmed");
    });
    playWinSound();
}

container.addEventListener("touchstart", (e)=>{
    enterFullscreen();
    initAudio();
    Array.from(e.changedTouches).forEach(touch=>{
        /* üî• LIMITE ALTERADO PARA 7 */
        if(Object.keys(touchesMap).length>=7) return;
        if(availableColors.length===0) return;

        const circle=document.createElement("div");
        circle.classList.add("touch");

        const randomIndex=Math.floor(Math.random()*availableColors.length);
        const color=availableColors.splice(randomIndex,1)[0];

        circle.dataset.color=color;
        circle.style.background=color;
        circle.style.left=touch.clientX+"px";
        circle.style.top=touch.clientY+"px";

        container.appendChild(circle);
        requestAnimationFrame(()=>circle.classList.add("active"));
        touchesMap[touch.identifier]=circle;
    });
    restartTimer();
});

container.addEventListener("touchmove",(e)=>{
    Array.from(e.changedTouches).forEach(touch=>{
        const circle = touchesMap[touch.identifier];
        if(circle){ 
            circle.style.left=touch.clientX+"px"; 
            circle.style.top=touch.clientY+"px"; 
        }
    });
},{passive:true});

container.addEventListener("touchend",(e)=>{
    Array.from(e.changedTouches).forEach(touch=>{
        const circle = touchesMap[touch.identifier];
        if(circle){
            circle.classList.remove("active");
            setTimeout(()=>{if(circle.parentNode) container.removeChild(circle)},350);
            availableColors.push(circle.dataset.color);
            delete touchesMap[touch.identifier];
        }
    });
    restartTimer();
});

container.addEventListener("touchcancel",(e)=>{
    Array.from(e.changedTouches).forEach(touch=>{
        const circle = touchesMap[touch.identifier];
        if(circle){
            availableColors.push(circle.dataset.color);
            container.removeChild(circle);
            delete touchesMap[touch.identifier];
        }
    });
    restartTimer();
});

window.addEventListener("resize", ()=>{
    container.style.width = window.innerWidth+"px";
    container.style.height = window.innerHeight+"px";
});

installBtnFixed.addEventListener("click", ()=>{
    installOverlay.style.display = "flex";
});

instagramBtn.addEventListener("click", ()=>{
    window.open("https://www.instagram.com/fabricio_benigno?igsh=MTU3bnI4aTkxYWZjeA%3D%3D&utm_source=qr","_blank");
});

closeOverlayBtn.addEventListener("click", ()=>{
    installOverlay.style.display = "none";
});
</script>
</body>
</html>
